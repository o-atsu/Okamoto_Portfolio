<html>
<head>
	<meta charset="utf-8" />
	<p>Atsushi Okamoto`s Portfolio</p>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/101/three.min.js"></script>
	<script src="js/controls/OrbitControls.js"></script>
	<script src="js/Detector.js"></script>
	<script>

	// ページの読み込みを待つ
window.addEventListener('load', init);
function init() {

	//WebGL非対応時の処理
	if(!Detector.webgl) Detector.addGetWebGLMessage();

	// サイズを指定
	const width = window.innerWidth - 10;
	const height = window.innerHeight - 60;

	// レンダラーを作成
	const renderer = new THREE.WebGLRenderer({
		canvas: document.querySelector('#myCanvas'),
		antialias:true
	});
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(width, height);

	// シーンを作成
	const scene = new THREE.Scene();

	// カメラを作成
	var camera = new THREE.PerspectiveCamera(45, width / height);
	camera.position.set(0, 0, +1000);
	var controls = new THREE.OrbitControls(camera);
	controls.center= new THREE.Vector3(0, 0, 0);
	controls.enablePan = false;

	//光源を生成
	const directionalLight1 = new THREE.DirectionalLight(0xffffff);
	directionalLight1.position.set(1, 1, 1);
	scene.add(directionalLight1);
	const directionalLight2 = new THREE.DirectionalLight(0xffffff);
	directionalLight2.position.set(1, -1, -1);
	scene.add(directionalLight2);

	// 形状とマテリアルからメッシュを作成
	var tetra = new THREE.Mesh(
		new THREE.TetrahedronGeometry(300),
		new THREE.MeshPhongMaterial({color:0x6699ff})
	);
	scene.add(tetra);


	//マウス座標取得、-1から1に正規化
	var mouseX = -1, mouseY = -1;
	document.addEventListener('mousemove', function(e){
		mouseX = (e.clientX / width) * 200 - 1;
		mouseY = (e.clientY / height) * -200 + 1;
	}, false);

	// OrbitControls設定
	controls.enableDamping = true;
	controls.dampingFactor = 0.9;

	// 毎フレーム時に実行されるループイベント
	function tick() {
		controls.update();

		// レンダリング
		renderer.render(scene, camera);
		requestAnimationFrame(tick);

		//マウスの指す座標にオブジェクトがあるかどうか
		var projector = new THREE.Projector();
		var pos = new Vector3(mouseX, mouseY, -100);
		var ray = projector.pickingRay(pos, camera);
		var intersects = ray.intersectObjects(scene.children);

		//マウスがmesh上時の処理
		if(intersects.length > 0 && intersects[0].object == tetra){
			tetra.material = new THREE.MeshNormalMaterial();
			controls.enabled = false;
		}else{
			tetra.material = new THREE.MeshPhongMaterial({color:0x6699ff})
			controls.enabled = true;
		}
	}
	tick();
}

	</script>
</head>
<body>
    <canvas id="myCanvas"></canvas>
</body>
</html>
